<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZoomWatch Test Page</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto; 
            background: #f5f5f5;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status { 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0;
            font-weight: bold;
        }
        .status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .status-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { 
            padding: 10px 15px; 
            margin: 5px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            background: #007bff; 
            color: white;
            font-size: 14px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .log { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            border-radius: 5px; 
            padding: 15px; 
            margin: 10px 0; 
            font-family: monospace; 
            font-size: 12px; 
            max-height: 300px; 
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .step { 
            margin: 15px 0; 
            padding: 15px; 
            background: #f8f9fa; 
            border-radius: 5px; 
            border-left: 4px solid #007bff; 
        }
        .step-number { 
            background: #007bff; 
            color: white; 
            border-radius: 50%; 
            width: 25px; 
            height: 25px; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            margin-right: 10px; 
            font-weight: bold; 
        }
        .instructions {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üîß ZoomWatch Extension Test Page</h1>
    <p>This page helps you test if your ZoomWatch extension is working properly.</p>
    
    <div class="instructions">
        <h3>üìã How to Test:</h3>
        <ol>
            <li>Make sure the ZoomWatch extension is loaded in Chrome</li>
            <li>Click the "Run All Tests" button below</li>
            <li>Check the results and follow any recommendations</li>
            <li>If tests fail, try the troubleshooting steps</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h3>üß™ Extension Tests</h3>
        <button id="runAllTests" onclick="runAllTests()">Run All Tests</button>
        <button id="clearLog" onclick="clearLog()">Clear Log</button>
        
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h3>üîç Manual Tests</h3>
        <div class="step">
            <span class="step-number">1</span>
            <strong>Check Extension Loading</strong>
            <button onclick="checkExtension()">Check Extension</button>
            <div id="extensionStatus"></div>
        </div>
        
        <div class="step">
            <span class="step-number">2</span>
            <strong>Test Content Script</strong>
            <button onclick="checkContentScript()">Check Content Script</button>
            <div id="contentScriptStatus"></div>
        </div>
        
        <div class="step">
            <span class="step-number">3</span>
            <strong>Test Communication</strong>
            <button onclick="testCommunication()">Test Communication</button>
            <div id="communicationStatus"></div>
        </div>
        
        <div class="step">
            <span class="step-number">4</span>
            <strong>Test ZoomWatch Object</strong>
            <button onclick="testZoomWatchObject()">Test ZoomWatch</button>
            <div id="zoomWatchStatus"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h3>üìù Test Log</h3>
        <div id="testLog" class="log">Click "Run All Tests" to start...</div>
    </div>
    
    <div class="test-section">
        <h3>üö® Troubleshooting</h3>
        <div class="status status-info">
            <strong>If tests fail:</strong>
            <ol>
                <li>Go to <code>chrome://extensions/</code></li>
                <li>Enable "Developer mode"</li>
                <li>Find ZoomWatch and click "Reload"</li>
                <li>Refresh this page and run tests again</li>
                <li>Check browser console for error messages</li>
            </ol>
        </div>
    </div>
    
    <script>
        let testResults = [];
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // Also add to test results
            testResults.push({ message, type, timestamp });
        }
        
        function clearLog() {
            document.getElementById('testLog').textContent = '';
            testResults = [];
        }
        
        function updateStatus(elementId, message, statusClass) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `status status-${statusClass}`;
        }
        
        async function checkExtension() {
            log('üîç Checking if extension is loaded...');
            
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    const manifest = chrome.runtime.getManifest();
                    log(`‚úÖ Extension loaded: ${manifest.name} v${manifest.version}`);
                    updateStatus('extensionStatus', 'Extension loaded successfully', 'success');
                    return true;
                } else {
                    log('‚ùå Chrome extension APIs not available');
                    updateStatus('extensionStatus', 'Extension not loaded', 'error');
                    return false;
                }
            } catch (error) {
                log(`‚ùå Error checking extension: ${error.message}`);
                updateStatus('extensionStatus', 'Error checking extension', 'error');
                return false;
            }
        }
        
        async function checkContentScript() {
            log('üîç Checking content script...');
            
            if (window.ZoomWatch) {
                log(`‚úÖ ZoomWatch content script loaded: v${window.ZoomWatch.version}`);
                updateStatus('contentScriptStatus', 'Content script loaded', 'success');
                return true;
            } else {
                log('‚ùå ZoomWatch content script not found');
                updateStatus('contentScriptStatus', 'Content script not loaded', 'error');
                return false;
            }
        }
        
        async function testCommunication() {
            log('üîå Testing extension communication...');
            
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    const response = await new Promise((resolve, reject) => {
                        chrome.runtime.sendMessage({ type: 'TEST' }, (response) => {
                            if (chrome.runtime.lastError) {
                                reject(new Error(chrome.runtime.lastError.message));
                            } else {
                                resolve(response);
                            }
                        });
                    });
                    
                    log('‚úÖ Communication test successful');
                    updateStatus('communicationStatus', 'Communication working', 'success');
                    return true;
                } else {
                    log('‚ùå Cannot test communication - extension not loaded');
                    updateStatus('communicationStatus', 'Cannot test - no extension', 'error');
                    return false;
                }
            } catch (error) {
                log(`‚ùå Communication test failed: ${error.message}`);
                updateStatus('communicationStatus', 'Communication failed', 'error');
                return false;
            }
        }
        
        async function testZoomWatchObject() {
            log('üß™ Testing ZoomWatch object...');
            
            if (window.ZoomWatch) {
                log(`‚úÖ ZoomWatch object exists: v${window.ZoomWatch.version}`);
                log(`üìä Is loaded: ${window.ZoomWatch.isLoaded}`);
                log(`‚è∞ Timestamp: ${new Date(window.ZoomWatch.timestamp).toLocaleString()}`);
                
                // Test if it has monitoring functions
                if (typeof window.ZoomWatch.startMonitoring === 'function') {
                    log('‚úÖ ZoomWatch has monitoring functions');
                } else {
                    log('‚ö†Ô∏è ZoomWatch missing monitoring functions');
                }
                
                updateStatus('zoomWatchStatus', 'ZoomWatch object working', 'success');
                return true;
            } else {
                log('‚ùå ZoomWatch object not found');
                updateStatus('zoomWatchStatus', 'ZoomWatch object missing', 'error');
                return false;
            }
        }
        
        async function runAllTests() {
            log('üöÄ Starting all tests...');
            
            const tests = [
                { name: 'Extension Loading', func: checkExtension },
                { name: 'Content Script', func: checkContentScript },
                { name: 'Communication', func: testCommunication },
                { name: 'ZoomWatch Object', func: testZoomWatchObject }
            ];
            
            let passed = 0;
            let total = tests.length;
            
            for (const test of tests) {
                log(`\n--- Running ${test.name} Test ---`);
                try {
                    const result = await test.func();
                    if (result) {
                        passed++;
                        log(`‚úÖ ${test.name} test passed`);
                    } else {
                        log(`‚ùå ${test.name} test failed`);
                    }
                } catch (error) {
                    log(`‚ùå ${test.name} test error: ${error.message}`);
                }
            }
            
            log(`\nüìä Test Results: ${passed}/${total} tests passed`);
            
            if (passed === total) {
                log('üéâ All tests passed! Your extension is working correctly.');
            } else {
                log('‚ö†Ô∏è Some tests failed. Check the troubleshooting section above.');
            }
        }
        
        // Auto-run basic check when page loads
        window.addEventListener('load', () => {
            log('üìÑ Page loaded, checking basic extension status...');
            checkExtension();
        });
    </script>
</body>
</html>
